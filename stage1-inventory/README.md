# Stage 1: Inventory Generation

Convert APIC GUI JSON exports into Ansible inventory files with management IP selection.

## Purpose

Generate Ansible-ready inventory files from APIC exports with:
- APIC controllers with priorities
- Spine and leaf switches with node IDs
- Management IP addresses (in-band/out-of-band selection)
- Pod-based groupings

## Required Input Files

You can obtain the required JSON files using either method:

### Method 1: APIC GUI Export (Original)

1. **Fabric Membership**: 
   - Path: Fabric â†’ Inventory â†’ Fabric Membership â†’ Export (JSON)
   - Contains: Node roles, IDs, models, pod assignments

2. **Static Node Management**:
   - Path: Tenant mgmt â†’ Static Node Management â†’ Export (JSON)
   - Contains: In-band and out-of-band management IP addresses

### Method 2: APIC CLI moquery Commands (Recommended)

For consistent, scriptable data collection, use these moquery commands from the APIC CLI:

```bash
# Fabric inventory (nodes, roles, models)
moquery -c fabricNode -o json > fabric_inventory.json

# Management IP assignments (in-band and out-of-band)
moquery -c mgmtRsInBStNode,mgmtRsOoBStNode -o json > management_ips.json
```

ðŸ“– **See [MOQUERY_COMMANDS.md](../MOQUERY_COMMANDS.md) for complete CLI reference and troubleshooting**

### Expected JSON Structure

Both methods should produce JSON files with this structure:
- Root-level `imdata` array containing managed objects
- `fabricNode` objects with attributes: id, name, role, model, serial, podId
- Management objects: `mgmtRsInBStNode` (in-band) and `mgmtRsOoBStNode` (out-of-band)

## Usage

### Quick Start with Sample Data

```bash
# Copy sample data to current directory
cp sample-data/*.json .

# Run inventory generator
python inventory-generator.py
```

### With Your Own APIC Exports

```bash
# Place your JSON exports in this directory
# Run the tool
python inventory-generator.py

# Follow interactive prompts to select files and management type
```

## Output

Generated files in `outputs/` directory:
- `aci-inventory.ini` - Ansible inventory file
- Timestamped backup copies

## Features

- **Auto-detection**: Finds JSON files automatically
- **Management Network Choice**: Select in-band vs out-of-band IPs
- **Professional UI**: Rich TUI with colored status and tables
- **Fallback Logic**: Uses alternate management IPs when preferred unavailable
- **Pod Groupings**: Automatically organizes by pod and device type

## Next Steps

After generating inventory:

1. Copy inventory to Stage 2:
   ```bash
   cp outputs/aci-inventory.ini ../stage2-placeholder/inputs/
   ```

2. Proceed to Stage 2 for next phase of workflow

## Example Output

```ini
# ACI Inventory Generated by inventory-generator.py
# Management Network: Out-of-band

[apics_pod_1]
apic1 ansible_host=10.0.1.11 priority=1
apic2 ansible_host=10.0.1.12 priority=2

[spines_pod_1]
spine1 ansible_host=10.0.1.101 node_id=101

[leaves_pod_1]
leaf1 ansible_host=10.0.1.201 node_id=201
```